<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>D'NestGlobal App</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#000000">
  <meta name="description" content="D'NestGlobal Progressive Web Application">
  <meta name="application-name" content="D'NestGlobal">
  
  <!-- iOS Meta Tags -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="D'NestGlobal">
  <meta name="format-detection" content="telephone=no">
  <meta name="mobile-web-app-capable" content="yes">

  <!-- Icons -->
  <link rel="icon" type="image/png" href="favicon-32x32.png">
  <link rel="apple-touch-icon" href="favicon-32x32.png">
  <link rel="manifest" href="manifest.json">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 500px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      text-align: center;
      color: #666;
      margin-bottom: 30px;
    }

    .feature {
      display: flex;
      align-items: center;
      margin: 15px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 10px;
    }

    .install-section {
      background: #e8f5e8;
      border: 2px solid #00c853;
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
      text-align: center;
    }

    .install-btn {
      background: linear-gradient(135deg, #00c853, #64dd17);
      color: white;
      border: none;
      padding: 15px 30px;
      border-radius: 25px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px;
      box-shadow: 0 4px 15px rgba(0,200,83,0.3);
    }

    .install-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .instructions {
      background: #e3f2fd;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      display: none;
    }

    .instructions.active {
      display: block;
    }

    .status-panel {
      background: #2c3e50;
      color: white;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
    }

    .status-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 10px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }

    .status-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 10px;
    }

    .good { background: #00c853; }
    .warning { background: #ff9800; }
    .bad { background: #f44336; }

    .debug {
      background: #1a1a1a;
      color: #00ff00;
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      font-family: monospace;
      font-size: 12px;
      max-height: 200px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ D'NestGlobal</h1>
    <p class="subtitle">Progressive Web App</p>

    <div class="feature">
      <span style="margin-right: 15px;">üì±</span>
      <span>Install on home screen</span>
    </div>
    <div class="feature">
      <span style="margin-right: 15px;">‚ö°</span>
      <span>Fast loading & offline support</span>
    </div>
    <div class="feature">
      <span style="margin-right: 15px;">üîî</span>
      <span>Push notifications</span>
    </div>

    <div class="install-section">
      <h3>üì≤ Install Our App</h3>
      <p>Get the full mobile experience</p>
      
      <button class="install-btn" id="androidInstall" disabled>
        Install for Android
      </button>
      
      <button class="install-btn" id="iosInstall">
        Install for iPhone
      </button>
    </div>

    <div class="instructions" id="androidInstructions">
      <h3>ü§ñ Android Installation</h3>
      <ol>
        <li>Tap Chrome menu (3 dots)</li>
        <li>Select "Add to Home screen"</li>
        <li>Confirm installation</li>
      </ol>
    </div>

    <div class="instructions" id="iosInstructions">
      <h3>üçé iPhone Installation</h3>
      <ol>
        <li>Tap Share button <span style="font-size:18px">‚éã</span></li>
        <li>Select "Add to Home Screen"</li>
        <li>Tap "Add"</li>
      </ol>
    </div>

    <div class="status-panel">
      <h3 style="color: white;">üîç Installation Status</h3>
      <div id="statusItems">
        <div class="status-item">
          <span>Service Worker</span>
          <div>
            <span class="status-indicator bad"></span>
            <span>Checking...</span>
          </div>
        </div>
        <div class="status-item">
          <span>Manifest</span>
          <div>
            <span class="status-indicator bad"></span>
            <span>Checking...</span>
          </div>
        </div>
        <div class="status-item">
          <span>Install Ready</span>
          <div>
            <span class="status-indicator bad"></span>
            <span>Checking...</span>
          </div>
        </div>
      </div>
    </div>

    <div class="debug">
      <strong>Console:</strong>
      <div id="debugConsole">Initializing...</div>
    </div>
  </div>

<script>
class GitHubPagesPWA {
  constructor() {
    this.deferredPrompt = null;
    this.isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
    this.isAndroid = /Android/.test(navigator.userAgent);
    this.isStandalone = window.matchMedia('(display-mode: standalone)').matches;
    
    this.elements = {
      androidInstall: document.getElementById('androidInstall'),
      iosInstall: document.getElementById('iosInstall'),
      androidInstructions: document.getElementById('androidInstructions'),
      iosInstructions: document.getElementById('iosInstructions'),
      statusItems: document.getElementById('statusItems'),
      debugConsole: document.getElementById('debugConsole')
    };

    this.init();
  }

  log(message, type = 'info') {
    const icons = { info: '‚ÑπÔ∏è', success: '‚úÖ', error: '‚ùå', warning: '‚ö†Ô∏è' };
    const messageHTML = `<div>${icons[type]} ${message}</div>`;
    
    console.log(`PWA: ${message}`);
    if (this.elements.debugConsole) {
      this.elements.debugConsole.innerHTML += messageHTML;
      this.elements.debugConsole.scrollTop = this.elements.debugConsole.scrollHeight;
    }
  }

  updateStatus(index, status, message) {
    const statusElement = this.elements.statusItems.children[index];
    if (statusElement) {
      const indicator = statusElement.querySelector('.status-indicator');
      const text = statusElement.querySelector('.status-item div span:last-child');
      
      indicator.className = `status-indicator ${status}`;
      text.textContent = message;
    }
  }

  async registerServiceWorker() {
    if (!('serviceWorker' in navigator)) {
      this.log('Service Worker not supported', 'error');
      return false;
    }

    try {
      // GitHub Pages requires service worker to be in root or same directory
      // Use current directory scope for GitHub Pages compatibility
      const registration = await navigator.serviceWorker.register('sw.js', {
        scope: './' // Current directory scope for GitHub Pages
      });

      this.log('Service Worker registered successfully', 'success');
      this.updateStatus(0, 'good', 'Registered');
      return true;

    } catch (error) {
      this.log(`Service Worker failed: ${error.message}`, 'error');
      this.updateStatus(0, 'bad', 'Failed');
      
      // Fallback: Try without scope
      try {
        const registration = await navigator.serviceWorker.register('sw.js');
        this.log('Service Worker registered without scope', 'warning');
        this.updateStatus(0, 'warning', 'Limited Scope');
        return true;
      } catch (error2) {
        this.log(`Fallback also failed: ${error2.message}`, 'error');
        return false;
      }
    }
  }

  checkManifest() {
    return new Promise((resolve) => {
      const manifestLink = document.querySelector('link[rel="manifest"]');
      if (!manifestLink) {
        this.updateStatus(1, 'bad', 'No Manifest');
        resolve(false);
        return;
      }

      fetch(manifestLink.href)
        .then(response => response.json())
        .then(manifest => {
          this.log('Manifest loaded successfully', 'success');
          this.updateStatus(1, 'good', 'Loaded');
          resolve(true);
        })
        .catch(error => {
          this.log(`Manifest error: ${error.message}`, 'error');
          this.updateStatus(1, 'bad', 'Load Failed');
          resolve(false);
        });
    });
  }

  setupEventListeners() {
    // Android/Chrome beforeinstallprompt
    window.addEventListener('beforeinstallprompt', (e) => {
      this.log('PWA installation available!', 'success');
      e.preventDefault();
      this.deferredPrompt = e;
      
      this.elements.androidInstall.disabled = false;
      this.elements.androidInstall.textContent = 'üì≤ Install Now';
      this.elements.androidInstructions.classList.add('active');
      this.updateStatus(2, 'good', 'Ready!');
    });

    // Android install
    this.elements.androidInstall.addEventListener('click', () => {
      if (this.deferredPrompt) {
        this.deferredPrompt.prompt();
        this.deferredPrompt.userChoice.then((choiceResult) => {
          this.log(`Install: ${choiceResult.outcome}`, 'success');
          this.deferredPrompt = null;
        });
      }
    });

    // iOS install
    this.elements.iosInstall.addEventListener('click', () => {
      this.elements.iosInstructions.classList.add('active');
      this.log('Showing iOS instructions', 'info');
    });

    // Track installation
    window.addEventListener('appinstalled', () => {
      this.log('App installed successfully!', 'success');
      this.updateStatus(2, 'good', 'Installed!');
    });
  }

  async init() {
    this.log('Initializing GitHub Pages PWA...');
    this.log(`Repo: ${window.location.hostname}`);
    this.log(`Standalone: ${this.isStandalone}`);

    // Check if we're on GitHub Pages
    if (window.location.hostname.includes('github.io')) {
      this.log('GitHub Pages detected - using compatible setup', 'info');
    }

    // Register service worker
    await this.registerServiceWorker();

    // Check manifest
    await this.checkManifest();

    // Setup events
    this.setupEventListeners();

    // Show iOS instructions on iOS
    if (this.isIOS) {
      this.elements.iosInstructions.classList.add('active');
    }

    this.log('PWA ready for installation');
  }
}

// Initialize
document.addEventListener('DOMContentLoaded', () => {
  new GitHubPagesPWA();
});
</script>
</body>
</html>
